SELECT
    t,
	ARRAY(
		SELECT
			epoch2timestamp(v)::time
		FROM
			generate_series(max(0, t - 10),  t) as v
	) AS v
	INTO test_time
FROM
	generate_series(1, 200) as t;
SET anyarray.similarity_type=cosine;
SELECT  t, similarity(v, to_tsp_array('{10,9,8,7,6,5,4,3,2,1}')::time[]) AS s FROM test_time 
	WHERE v % to_tsp_array('{10,9,8,7,6,5,4,3,2,1}')::time[] ORDER BY s DESC, t;
 t  |    s     
----+----------
 10 | 0.953463
 11 | 0.953463
  9 |      0.9
 12 | 0.858116
  8 | 0.843274
  7 | 0.782624
 13 |  0.76277
  6 | 0.717137
 14 | 0.667424
  5 | 0.645497
(10 rows)

SELECT  t, similarity(v, to_tsp_array('{50,49,8,7,6,5,4,3,2,1}')::time[]) AS s FROM test_time 
	WHERE v % to_tsp_array('{50,49,8,7,6,5,4,3,2,1}')::time[] ORDER BY s DESC, t;
 t  |    s     
----+----------
  8 | 0.843274
  9 |      0.8
  7 | 0.782624
 10 |  0.76277
 11 |  0.76277
  6 | 0.717137
 12 | 0.667424
  5 | 0.645497
(8 rows)

SET anyarray.similarity_type=jaccard;
SELECT  t, similarity(v, to_tsp_array('{10,9,8,7,6,5,4,3,2,1}')::time[]) AS s FROM test_time 
	WHERE v % to_tsp_array('{10,9,8,7,6,5,4,3,2,1}')::time[] ORDER BY s DESC, t;
 t  |    s     
----+----------
 10 | 0.909091
 11 | 0.909091
  9 | 0.818182
 12 |     0.75
  8 | 0.727273
  7 | 0.636364
 13 | 0.615385
(7 rows)

SELECT  t, similarity(v, to_tsp_array('{50,49,8,7,6,5,4,3,2,1}')::time[]) AS s FROM test_time 
	WHERE v % to_tsp_array('{50,49,8,7,6,5,4,3,2,1}')::time[] ORDER BY s DESC, t;
 t  |    s     
----+----------
  8 | 0.727273
  9 | 0.666667
  7 | 0.636364
 10 | 0.615385
 11 | 0.615385
(5 rows)

SELECT t, v FROM test_time WHERE v && to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 43 | {00:00:33,00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43}
 44 | {00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44}
 45 | {00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45}
 46 | {00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46}
 47 | {00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47}
 48 | {00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48}
 49 | {00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49}
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
 54 | {00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54}
 55 | {00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55}
 56 | {00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56}
 57 | {00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57}
 58 | {00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58}
 59 | {00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59}
 60 | {00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59,00:01:00}
(18 rows)

SELECT t, v FROM test_time WHERE v @> to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
(4 rows)

SELECT t, v FROM test_time WHERE v <@ to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  1 | {00:00:00,00:00:01}
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(10 rows)

SELECT t, v FROM test_time WHERE v =  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(1 row)

SET anyarray.similarity_type=cosine;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
(12 rows)

SET anyarray.similarity_type=jaccard;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
(7 rows)

SET anyarray.similarity_type=overlap;
SET anyarray.similarity_threshold = 3;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
 15 | {00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15}
 16 | {00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16}
 17 | {00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17}
 18 | {00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17,00:00:18}
(17 rows)

RESET anyarray.similarity_threshold;
CREATE INDEX idx_test_time ON test_time USING gist (v _time_aa_ops);
SET enable_seqscan=off;
EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v && to_tsp_array('{43,50}')::time[] ORDER BY t;
                                    QUERY PLAN                                    
----------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v && '{00:00:43,00:00:50}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v && '{00:00:43,00:00:50}'::time without time zone[])
(6 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v @> to_tsp_array('{43,50}')::time[] ORDER BY t;
                                 QUERY PLAN                                 
----------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Index Scan using idx_test_time on test_time
         Index Cond: (v @> '{00:00:43,00:00:50}'::time without time zone[])
(4 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v <@ to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Index Scan using idx_test_time on test_time
         Index Cond: (v <@ '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(4 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v =  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Index Scan using idx_test_time on test_time
         Index Cond: (v = '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(4 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Index Scan using idx_test_time on test_time
         Index Cond: (v % '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(4 rows)

SELECT t, v FROM test_time WHERE v && to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 43 | {00:00:33,00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43}
 44 | {00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44}
 45 | {00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45}
 46 | {00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46}
 47 | {00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47}
 48 | {00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48}
 49 | {00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49}
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
 54 | {00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54}
 55 | {00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55}
 56 | {00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56}
 57 | {00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57}
 58 | {00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58}
 59 | {00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59}
 60 | {00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59,00:01:00}
(18 rows)

SELECT t, v FROM test_time WHERE v @> to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
(4 rows)

SELECT t, v FROM test_time WHERE v <@ to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  1 | {00:00:00,00:00:01}
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(10 rows)

SELECT t, v FROM test_time WHERE v =  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(1 row)

SET anyarray.similarity_type=cosine;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
(12 rows)

SET anyarray.similarity_type=jaccard;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
(7 rows)

SET anyarray.similarity_type=overlap;
SET anyarray.similarity_threshold = 3;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
 15 | {00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15}
 16 | {00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16}
 17 | {00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17}
 18 | {00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17,00:00:18}
(17 rows)

RESET anyarray.similarity_threshold;
DROP INDEX idx_test_time;
CREATE INDEX idx_test_time ON test_time USING gin (v _time_aa_ops);
SET enable_seqscan=off;
EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v && to_tsp_array('{43,50}')::time[] ORDER BY t;
                                    QUERY PLAN                                    
----------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v && '{00:00:43,00:00:50}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v && '{00:00:43,00:00:50}'::time without time zone[])
(6 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v @> to_tsp_array('{43,50}')::time[] ORDER BY t;
                                    QUERY PLAN                                    
----------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v @> '{00:00:43,00:00:50}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v @> '{00:00:43,00:00:50}'::time without time zone[])
(6 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v <@ to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                            QUERY PLAN                                                                             
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v <@ '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v <@ '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(6 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v =  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                            QUERY PLAN                                                                            
------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v = '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v = '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(6 rows)

EXPLAIN (COSTS OFF) SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
                                                                            QUERY PLAN                                                                            
------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t
   ->  Bitmap Heap Scan on test_time
         Recheck Cond: (v % '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
         ->  Bitmap Index Scan on idx_test_time
               Index Cond: (v % '{00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}'::time without time zone[])
(6 rows)

SELECT t, v FROM test_time WHERE v && to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 43 | {00:00:33,00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43}
 44 | {00:00:34,00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44}
 45 | {00:00:35,00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45}
 46 | {00:00:36,00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46}
 47 | {00:00:37,00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47}
 48 | {00:00:38,00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48}
 49 | {00:00:39,00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49}
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
 54 | {00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54}
 55 | {00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55}
 56 | {00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56}
 57 | {00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57}
 58 | {00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58}
 59 | {00:00:49,00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59}
 60 | {00:00:50,00:00:51,00:00:52,00:00:53,00:00:54,00:00:55,00:00:56,00:00:57,00:00:58,00:00:59,00:01:00}
(18 rows)

SELECT t, v FROM test_time WHERE v @> to_tsp_array('{43,50}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 50 | {00:00:40,00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50}
 51 | {00:00:41,00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51}
 52 | {00:00:42,00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52}
 53 | {00:00:43,00:00:44,00:00:45,00:00:46,00:00:47,00:00:48,00:00:49,00:00:50,00:00:51,00:00:52,00:00:53}
(4 rows)

SELECT t, v FROM test_time WHERE v <@ to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  1 | {00:00:00,00:00:01}
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(10 rows)

SELECT t, v FROM test_time WHERE v =  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
(1 row)

SET anyarray.similarity_type=cosine;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
(12 rows)

SET anyarray.similarity_type=jaccard;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
(7 rows)

SET anyarray.similarity_type=overlap;
SET anyarray.similarity_threshold = 3;
SELECT t, v FROM test_time WHERE v %  to_tsp_array('{0,1,2,3,4,5,6,7,8,9,10}')::time[] ORDER BY t;
 t  |                                                  v                                                   
----+------------------------------------------------------------------------------------------------------
  2 | {00:00:00,00:00:01,00:00:02}
  3 | {00:00:00,00:00:01,00:00:02,00:00:03}
  4 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04}
  5 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05}
  6 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06}
  7 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07}
  8 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08}
  9 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09}
 10 | {00:00:00,00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10}
 11 | {00:00:01,00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11}
 12 | {00:00:02,00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12}
 13 | {00:00:03,00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13}
 14 | {00:00:04,00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14}
 15 | {00:00:05,00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15}
 16 | {00:00:06,00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16}
 17 | {00:00:07,00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17}
 18 | {00:00:08,00:00:09,00:00:10,00:00:11,00:00:12,00:00:13,00:00:14,00:00:15,00:00:16,00:00:17,00:00:18}
(17 rows)

RESET anyarray.similarity_threshold;
